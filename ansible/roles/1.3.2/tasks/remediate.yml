---

- name: 1.3.2.result
  shell: 'grep SBD_STARTMODE sbd'
  args:
    chdir: "/etc/sysconfig/"
  check_mode: no
  register: result
  changed_when: false

- import_role:
    name: cluster_stop
  when:
    - result.stdout != expected['1.3.2']
    - not ansible_check_mode
    - inventory_hostname == groups.target[0]

- name: 1.3.2.remediate
  replace:
    path: /etc/sysconfig/sbd
    regexp: '^\s*SBD_STARTMODE=[a-zA-Z]+?$'
    replace: '{{ expected["1.3.2"] }}'
  register: config_updated

- import_role:
    name: cluster_start
  when:
    - config_updated is changed
    - not ansible_check_mode
    - inventory_hostname == groups.target[0]

